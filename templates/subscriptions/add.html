{% extends "base.html" %}
{% block content %}

<style>

    .add-wrap {
        padding: 18px;
        display: grid;
        grid-template-columns: minmax(320px, 420px) minmax(260px, 1fr);
        gap: 20px;
    }
    @media(max-width:900px){
        .add-wrap { grid-template-columns: 1fr; }
    }

    .box {
        padding: 20px;
        border-radius: 18px;
        background: var(--card-bg);
        border: 1px solid rgba(148,163,184,.28);
        box-shadow: 0 14px 38px rgba(15,23,42,.8);
    }

    .title {
        font-size: 22px;
        font-weight: 800;
        margin-bottom: 4px;
    }
    .sub {
        font-size: 12px;
        opacity: .7;
        margin-bottom: 18px;
    }

    .form-select, .form-control {
        background: rgba(15,23,42,0.96);
        color: var(--text);
        border-radius: 12px;
        border: 1px solid rgba(75,85,99,.85);
    }
    .form-control:focus,
    .form-select:focus {
        border-color: #38bdf8;
        outline: none;
        box-shadow: 0 0 0 1px rgba(56,189,248,.4);
    }

    /* Preview */
    .preview-box {
        background: radial-gradient(circle at top left, rgba(56,189,248,.22), transparent 60%),
                    radial-gradient(circle at bottom right, rgba(139,92,246,.22), transparent 60%),
                    var(--card-bg);
        border-radius: 18px;
        border: 1px solid rgba(148,163,184,.32);
        padding: 20px;
        box-shadow: 0 20px 40px rgba(15,23,42,.9);
    }

    .pr-line { font-size: 14px; margin-top: 6px; }
    .btn-save {
        margin-top: 15px;
        padding: 10px 18px;
        background: linear-gradient(135deg, #22c55e, #4f46e5);
        border-radius: 999px;
        color: white;
        font-weight: 700;
        border: none;
        box-shadow: 0 12px 30px rgba(34,197,94,.6);
    }

</style>

<div class="add-wrap">

    <!-- LEFT FORM -->
    <div class="box">
        <div class="title">New Subscription</div>
        <div class="sub">Choose a member â€¢ choose a plan â€¢ auto-expiry preview</div>

        <form method="POST">
            {% csrf_token %}

            <label class="form-label">Member</label>
            <select class="form-select" name="member" id="member" required>
                <option value="">-- Select Member --</option>
                {% for m in members %}
                <option value="{{ m.id }}">{{ m.full_name }} â€¢ {{ m.phone }}</option>
                {% endfor %}
            </select>

            <label class="form-label mt-3">Plan</label>
            <select class="form-select" name="plan" id="plan" required onchange="updatePlanPreview()">
                <option value="">-- Select Plan --</option>
                {% for p in plans %}
                <option value="{{ p.id }}"
                    data-type="{{ p.duration_type }}"
                    data-value="{{ p.duration_value }}"
                    data-price="{{ p.price }}">
                    {{ p.name }} â€” â‚¹{{ p.price }}
                </option>
                {% endfor %}
            </select>

            <button class="btn-save">Save Subscription</button>
        </form>
    </div>


    <!-- RIGHT LIVE PREVIEW -->
    <div class="preview-box">
        <div class="title">ðŸ“Š Subscription Preview</div>

        <div class="pr-line" id="pr_member">Member: â€”</div>
        <div class="pr-line" id="pr_plan">Plan: â€”</div>
        <div class="pr-line" id="pr_price">Price: â‚¹0</div>
        <div class="pr-line" id="pr_start">Start Date: Today</div>
        <div class="pr-line" id="pr_end">End Date: â€”</div>
    </div>

</div>

<script>
    const members = document.getElementById("member");
    const plans = document.getElementById("plan");

    function updatePlanPreview() {
        const p = plans.options[plans.selectedIndex];
        const type = p.dataset.type;
        const value = parseInt(p.dataset.value || 0);
        const price = p.dataset.price;

        document.getElementById("pr_plan").textContent = "Plan: " + p.textContent.trim();
        document.getElementById("pr_price").textContent = "Price: â‚¹" + price;

        let end = new Date();
        if (type === "days") end.setDate(end.getDate() + value);
        if (type === "weeks") end.setDate(end.getDate() + value * 7);
        if (type === "months") end.setDate(end.getDate() + value * 30);

        document.getElementById("pr_end").textContent =
            "End Date: " + end.toISOString().slice(0, 10);
    }

    members.addEventListener("change", () => {
        document.getElementById("pr_member").textContent =
            "Member: " + members.options[members.selectedIndex].textContent.trim();
    });

</script>

{% endblock %}
